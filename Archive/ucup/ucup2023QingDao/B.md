# [UCUP-2 QingDao B. Red Black Tree](https://contest.ucup.ac/contest/1339/problem/7103)

> 队友说是虚树，所以打算整理一下，后来发现只是题读假了233，这题只需要倍增。

## 题意

有一颗 $n$ 个节点的带边权有根树，其中 $m$ 个节点为红色，剩下的为黑色，并且根为红色。

定义红色点的代价为 $0$，黑色点的代价为其到最近红色祖先的路径长度。

$q$ 次询问，每次给定一个大小为 $k$ 的点集，你可以最多修改任意的一个点，将其颜色变为红色（包括点集中的点），最小化花费的最大值。询问间相互独立。

$\sum n \le 10^6,\sum k \le 2 \times 10^6$。

## 思路

首先预处理每个点的代价。

要最小化最大值，必然要优先处理代价最大的几个点。将给定的 $k$ 个关键点按照代价排降序，枚举前缀，使一个前缀每个点的 **代价都变小** 且 代价最小化 的涂色方案即为它们的LCA。对枚举过程的 $\max\{前缀代价,后缀代价\}$ 取 $\min$ 即为答案。

单次询问复杂度为 $\mathcal{O}(k \log n)$。

> [评测记录](https://contest.ucup.ac/submission/162841)